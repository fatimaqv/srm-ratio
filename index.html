<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GR/year ‚Äì C√°lculo de crecimiento tumoral</title>
  <style>
    :root{
      --primary:#004b87;
      --primary-600:#0060b3;
      --ok:#16a34a;
      --warn:#ca8a04;
      --bad:#dc2626;
      --muted:#6b7280;
    }
    body {
      font-family: system-ui, "Segoe UI", sans-serif;
      background-color: #f7f9fc;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 16px;
    }
    h1 { color: var(--primary); margin: 0 0 .25rem; text-align:center; }
    p  { color: #555; margin: 0 0 1rem; font-size: .95rem; text-align:center; }

    .card {
      background: #fff;
      padding: 1.25rem;
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
      width: min(420px, 95vw);
    }
    label { display:block; font-weight:600; margin-top:.6rem; }
    input {
      width: 100%; padding: .55rem .6rem; margin-top: .25rem;
      border: 1px solid #cfd6e0; border-radius: 8px; box-sizing: border-box;
      font-size: 1rem;
    }
    .btn-row{ display:flex; gap:.6rem; margin-top:.9rem; }
    .btn{
      flex:1; padding:.7rem .9rem; border:none; border-radius:8px; cursor:pointer;
      font-size:1rem; background:var(--primary); color:#fff;
    }
    .btn.secondary{ background:#e9eef6; color:#163f5f; }
    .btn:hover{ background:var(--primary-600); }
    .btn.secondary:hover{ background:#dfe7f3; }

    .result { margin-top: 1rem; text-align:center; font-weight:700; font-size:1.25rem; }
    .badge  { margin-top: .3rem; text-align:center; font-weight:700; }
    .note   { margin-top: .35rem; font-size: .95rem; color:#444; text-align:center; }
    .disclaimer { margin-top: .9rem; font-size: .8rem; color: var(--muted); text-align:center; }

    .toast{
      position: fixed; left:50%; transform:translateX(-50%);
      bottom:16px; background:#111827; color:#fff; padding:.55rem .8rem;
      border-radius:10px; font-size:.9rem; opacity:0; pointer-events:none;
      transition:opacity .2s ease;
    }
    .toast.show{ opacity:1; }

    /* Tarjeta de impresi√≥n */
    @media print {
      body{ background:#fff; }
      .card, h1, p{ box-shadow: none; }
      .no-print{ display:none !important; }
      .print-card{
        display:block !important;
        border:1px solid #cbd5e1; border-radius:12px; padding:16px; margin-top:12px;
      }
    }
    /* Oculta tarjeta de impresi√≥n en pantalla  */
    .print-card{ display:none; }
  </style>
</head>
<body>
  <h1 class="no-print">Growth Ratio (GR/year)</h1>
  <p class="no-print">Basado en el di√°metro m√°ximo tumoral (MTD)</p>

  <div class="card">
    <label>Fecha inicial (A)</label>
    <input type="date" id="dateA">

    <label>Di√°metro A (cm)</label>
    <input type="number" id="diamA" step="0.01" placeholder="Ej. 2.1">

    <label>Fecha control (B)</label>
    <input type="date" id="dateB">

    <label>Di√°metro B (cm)</label>
    <input type="number" id="diamB" step="0.01" placeholder="Ej. 3.2">

    <div class="btn-row no-print">
      <button class="btn" onclick="calcGR()">Calcular GR/year</button>
      <button class="btn secondary" onclick="resetForm()">Limpiar</button>
    </div>

    <div class="result" id="res">‚Äî</div>
    <div class="badge"  id="badge"></div>
    <div class="note"   id="interpret"></div>

    <div class="btn-row no-print" style="margin-top:.8rem;">
      <button class="btn secondary" onclick="copySummary()">Copiar resultado</button>
      <button class="btn secondary" onclick="printSummary()">Imprimir</button>
    </div>

    <div class="disclaimer">
      Umbrales orientativos internacionales (ajuste a protocolo local si corresponde). Esta herramienta no reemplaza el juicio cl√≠nico.
    </div>
  </div>

  <!-- Tarjeta limpia para impresi√≥n -->
  <div id="printCard" class="print-card">
    <div style="font-weight:700; color:var(--primary); margin-bottom:6px;">Growth Ratio (GR/year)</div>
    <div id="pA"></div>
    <div id="pB"></div>
    <div id="pMeses"></div>
    <div id="pGR" style="margin-top:4px; font-weight:700;"></div>
    <div id="pInterp" style="margin-top:2px;"></div>
  </div>

  <div id="toast" class="toast">Copiado</div>

  <script>
    function monthsBetween(dateA, dateB) {
      const dA = new Date(dateA);
      const dB = new Date(dateB);
      return (dB - dA) / (1000 * 60 * 60 * 24 * 30.4375); // mes promedio
    }

    function fmt(n, d=2){ return Number.isFinite(n) ? n.toFixed(d) : "‚Äî"; }

    function calcGR() {
      const A = parseFloat(document.getElementById("diamA").value);
      const B = parseFloat(document.getElementById("diamB").value);
      const dateA = document.getElementById("dateA").value;
      const dateB = document.getElementById("dateB").value;

      const res   = document.getElementById("res");
      const badge = document.getElementById("badge");
      const interp= document.getElementById("interpret");

      // Validaciones
      if ((!Number.isFinite(A) && A !== 0) || (!Number.isFinite(B) && B !== 0) || !dateA || !dateB) {
        res.textContent    = "Ingrese todos los valores";
        badge.textContent  = "";
        badge.style.color  = "";
        interp.textContent = "";
        return;
      }
      const meses = monthsBetween(dateA, dateB);
      if (!isFinite(meses) || meses <= 0) {
        res.textContent    = "Fechas inv√°lidas";
        badge.textContent  = "";
        badge.style.color  = "";
        interp.textContent = "";
        return;
      }

      // F√≥rmula internacional:
      // GR/year (cm/a√±o) = ((B - A) / meses) * 12
      const GR = ((B - A) / meses) * 12;
      res.textContent = `GR/year = ${fmt(GR)} cm/a√±o`;

      // Sem√°foro + interpretaci√≥n (umbrales internacionales)
      if (GR <= 0) {
        badge.textContent  = "‚úÖ Estable / disminuye (verde)";
        badge.style.color  = "#16a34a";
        interp.textContent = "Sin crecimiento medible o reducci√≥n del tama√±o. Mantener seguimiento est√°ndar.";
      } else if (GR <= 0.5) {
        badge.textContent  = "‚ö†Ô∏è Crecimiento lento (amarillo)";
        badge.style.color  = "#ca8a04";
        interp.textContent = "Crecimiento bajo. Continuar vigilancia activa seg√∫n calendario habitual.";
      } else {
        badge.textContent  = "üî¥ Crecimiento significativo (rojo)";
        badge.style.color  = "#dc2626";
        interp.textContent = "Aumento relevante del tama√±o. Considerar reevaluaci√≥n y conducta seg√∫n protocolo local.";
      }

      // Actualiza datos de impresi√≥n
      updatePrintCard({A, B, dateA, dateB, meses, GR, texto: interp.textContent});
    }

    function resetForm(){
      ["diamA","diamB","dateA","dateB"].forEach(id => document.getElementById(id).value = "");
      ["res","badge","interpret"].forEach(id => document.getElementById(id).textContent = "");      
    }

    function showToast(msg="Copiado"){
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1300);
    }

    function summaryText(){
      const A = parseFloat(document.getElementById("diamA").value);
      const B = parseFloat(document.getElementById("diamB").value);
      const dateA = document.getElementById("dateA").value;
      const dateB = document.getElementById("dateB").value;
      const res   = document.getElementById("res").textContent || "";
      const interp= document.getElementById("interpret").textContent || "";

      if (!A && A!==0 || !B && B!==0 || !dateA || !dateB || !res.includes("GR/year")) {
        return "Complete los datos y calcule el GR/year antes de copiar.";
      }

      const meses = monthsBetween(dateA, dateB);
      return [
        `Fecha A: ${dateA} | Di√°metro A: ${fmt(A)} cm`,
        `Fecha B: ${dateB} | Di√°metro B: ${fmt(B)} cm`,
        `Intervalo: ${fmt(meses,1)} meses`,
        `${res}`,
        `Interpretaci√≥n: ${interp}`
      ].join("\n");
    }

    async function copySummary(){
      const text = summaryText();
      try{
        await navigator.clipboard.writeText(text);
        showToast("Resultado copiado");
      }catch{
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text; document.body.appendChild(ta);
        ta.select(); document.execCommand("copy"); ta.remove();
        showToast("Resultado copiado");
      }
    }

    function updatePrintCard({A,B,dateA,dateB,meses,GR,texto}){
      document.getElementById("pA").textContent     = `Fecha A: ${dateA} | Di√°metro A: ${fmt(A)} cm`;
      document.getElementById("pB").textContent     = `Fecha B: ${dateB} | Di√°metro B: ${fmt(B)} cm`;
      document.getElementById("pMeses").textContent = `Intervalo: ${fmt(meses,1)} meses`;
      document.getElementById("pGR").textContent    = `GR/year = ${fmt(GR)} cm/a√±o`;
      document.getElementById("pInterp").textContent= texto || "";
    }

    function printSummary(){
      // Si no hay c√°lculo, intenta generar uno
      const res = document.getElementById("res").textContent || "";
      if (!res.includes("GR/year")) calcGR();
      window.print();
    }
  </script>
</body>
</html>
